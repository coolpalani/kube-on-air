---
- name: setup ubuntu based kube node
  hosts: node
  gather_facts: true
  tasks:
    - name: install apt packages
      apt: name={{ item }} state=present update_cache=true
      items:
        - init-system-helpers
      become: true

    - name: disable swap on the master for kublet1.8 to run
      command: swapoff -a
      become: true

    - name: install gce encription key
      apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
        state: present
      become: true

    - name: add gce kubernetes repository
      apt_repository:
        repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
        state: present
        filename: kubernetes.list
      become: true

    - name: install kubernetes packages
      apt: name={{ item }} state=present update_cache=false
      items:
        - kubelet
        - kubeadm
        - kubernetes-cni
      become: true
      when: ansible_distribution_version == "16.04"
